---
title: "Multinomial modeling - India"
output:
  html_document:
    df_print: paged
---


```{r}
suppressPackageStartupMessages({
  library(epicovr)
  library(tidyverse)
})
theme_set(EpicovrTheme())
```

```{r, eval=TRUE, echo=FALSE}
gisaid_metadata <- qs::qread(file = "~/github/2021_Covid19_surveillance/data/all_metadata/metadata_tsv_2022_03_25.qs")
gisaid_india <- FilterGISAIDIndia(gisaid_metadata_all = gisaid_metadata)

vocs <- GetVOCs()
vocs[["omicron"]] <- NULL
custom_voc_mapping <- list(
  `BA.1.1` = "Omicron-BA.1.1", `BA.1` = "Omicron-BA.1",
  `BA.2` = "Omicron-BA.2"
)
```


```{r}
gisaid_india_collapsed <- CollapseLineageToVOCs(
  variant_df = gisaid_india,
  vocs = vocs,
  custom_voc_mapping = custom_voc_mapping,
  summarize = FALSE
)

gisaid_india_collapsed_sel <- gisaid_india_collapsed %>% filter(MonthYearCollected >= "Nov 2021") 
vocs_to_keep <- table(gisaid_india_collapsed_sel$lineage_collapsed)
vocs_to_keep <- vocs_to_keep[vocs_to_keep > 100]

gisaid_india_collapsed_sel <- gisaid_india_collapsed_sel %>% filter(lineage_collapsed %in% names(vocs_to_keep))

gisaid_india_shared_dateweek <- SummarizeVariantsDatewise(gisaid_india_collapsed_sel, by_state = TRUE)
head(gisaid_india_shared_dateweek)
```

```{r}
fit_india_multi_predsbystate <- FitMultinomStatewiseDaily(gisaid_india_shared_dateweek)
head(fit_india_multi_predsbystate)
```

# Plot Smooth Muller Plots

```{r, fig.width=13, fig.height=13}
muller_indiabystate_mfit <- PlotMullerDailyPrevalence(fit_india_multi_predsbystate)
muller_indiabystate_mfit
```
